<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>单词带背系统</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        /* 新增词库卡片样式 */
        .lib-card {
            background: var(--card-bg);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            transition: all 0.3s;
            border: 2px solid transparent;
            margin-bottom: 15px;
        }
        
        .lib-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.15);
            border-color: var(--info);
        }
        
        .lib-card h4 {
            color: var(--secondary);
            margin-bottom: 10px;
            font-size: 1.4rem;
        }
        
        .lib-card p {
            color: #666;
            margin-bottom: 15px;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        :root {
            --primary: #4361ee;
            --secondary: #3f37c9;
            --success: #4cc9f0;
            --info: #4895ef;
            --warning: #f72585;
            --danger: #e63946;
            --light: #f8f9fa;
            --dark: #212529;
            --bg: #f0f7ff;
            --card-bg: #ffffff;
            --shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            --plan-complete: #4ade80;
            --plan-incomplete: #f87171;
            --plan-noclass: #a0aec0;
            --plan-leave: #f6ad55;
        }
        
        body {
            background: linear-gradient(135deg, #e0f7fa, #bbdefb);
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        /* 登录页样式 */
        .login-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            background: linear-gradient(135deg, #4361ee, #3a0ca3);
            border-radius: 20px;
            padding: 20px;
            box-shadow: var(--shadow);
            color: white;
            text-align: center;
        }
        
        .login-container h1 {
            font-size: 3.5rem;
            margin-bottom: 20px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
            color: #ffd166;
        }
        
        .login-container p {
            font-size: 1.2rem;
            margin-bottom: 40px;
            max-width: 600px;
        }
        
        .password-box {
            background: rgba(255, 255, 255, 0.2);
            padding: 30px;
            border-radius: 15px;
            width: 100%;
            max-width: 450px;
            backdrop-filter: blur(10px);
        }
        
        .password-box input {
            width: 100%;
            padding: 15px;
            border-radius: 50px;
            border: none;
            font-size: 1.2rem;
            margin-bottom: 20px;
            text-align: center;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }
        
        .password-box button {
            background: #ffd166;
            color: #073b4c;
            border: none;
            padding: 15px 40px;
            border-radius: 50px;
            font-size: 1.2rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
        }
        
        .password-box button:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 15px rgba(0,0,0,0.3);
        }
        
        /* 主页面样式 */
        .page {
            display: none;
            background-color: white;
            border-radius: 20px;
            box-shadow: var(--shadow);
            overflow: hidden;
            min-height: 90vh;
        }
        
        .header {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: relative;
        }
        
        .header h1 {
            font-size: 2.5rem;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }
        
        .top-right-buttons {
            position: absolute;
            top: 20px;
            right: 20px;
            display: flex;
            gap: 10px;
        }
        
        .back-btn {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 1rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 5px;
            transition: all 0.3s;
        }
        
        .back-btn:hover {
            background: rgba(255, 255, 255, 0.3);
        }
        
        .main-menu {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 25px;
            padding: 30px;
        }
        
        .menu-card {
            background: var(--card-bg);
            border-radius: 15px;
            padding: 25px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            border: 3px solid transparent;
        }
        
        .menu-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 12px 20px rgba(0,0,0,0.15);
            border-color: var(--success);
        }
        
        .menu-card i {
            font-size: 3.5rem;
            margin-bottom: 15px;
            color: var(--primary);
        }
        
        .menu-card h2 {
            color: var(--secondary);
            margin-bottom: 10px;
        }
        
        .menu-card p {
            color: #666;
            font-size: 1rem;
        }
        
        /* 二级页面样式 */
        .sub-header {
            background: linear-gradient(135deg, var(--info), var(--primary));
            color: white;
            padding: 15px 20px;
            display: flex;
            align-items: center;
        }
        
        .content {
            padding: 25px;
            max-height: calc(100vh - 200px);
            overflow-y: auto;
        }
        
        .card {
            background: var(--card-bg);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 25px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
        }
        
        .card h3 {
            color: var(--secondary);
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--info);
        }
        
        .btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 50px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s;
            margin: 5px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        
        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 15px rgba(0,0,0,0.2);
            background: var(--secondary);
        }
        
        .btn-success {
            background: var(--success);
        }
        
        .btn-warning {
            background: var(--warning);
        }
        
        .btn-danger {
            background: var(--danger);
        }
        
        /* 单词学习样式 */
        .word-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .word-card {
            background: white;
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
            border: 2px solid #e9ecef;
            transition: all 0.3s;
            height: 220px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }
        
        .word-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.1);
        }
        
        .word-card h4 {
            font-size: 1.8rem;
            margin-bottom: 10px;
            color: var(--secondary);
            cursor: pointer;
        }
        
        .word-info {
            color: #666;
            font-size: 1.1rem;
            margin: 10px 0;
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }
        
        .word-actions {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 15px;
        }
        
        .action-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 1.2rem;
            color: white;
            border: none;
        }
        
        /* 进度条样式 */
        .progress-container {
            width: 100%;
            background: #e9ecef;
            border-radius: 10px;
            margin: 20px 0;
            height: 20px;
        }
        
        .progress-bar {
            height: 100%;
            background: var(--success);
            border-radius: 10px;
            transition: width 0.4s;
        }
        
        /* 复习模式样式 */
        .review-container {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-top: 20px;
        }
        
        .review-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
            border: 2px solid #e9ecef;
            transition: all 0.3s;
            width: calc(50% - 10px);
            min-width: 300px;
            cursor: pointer;
        }
        
        .review-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.1);
        }
        
        .review-card i {
            font-size: 3rem;
            color: var(--primary);
            margin-bottom: 15px;
        }
        
        .review-card h3 {
            color: var(--secondary);
            margin-bottom: 10px;
        }
        
        .review-card p {
            color: #666;
        }
        
        /* 答题区域 */
        .quiz-area {
            background: white;
            border-radius: 15px;
            padding: 30px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
            margin: 20px 0;
        }
        
        .quiz-word {
            font-size: 2.5rem;
            color: var(--secondary);
            margin: 20px 0;
            cursor: pointer;
        }
        
        .quiz-options {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin: 30px 0;
        }
        
        .quiz-option {
            background: var(--light);
            border: 2px solid #ddd;
            border-radius: 10px;
            padding: 15px;
            font-size: 1.2rem;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .quiz-option:hover {
            background: #e9ecef;
        }
        
        .quiz-option.correct {
            background: #d4edda;
            border-color: #c3e6cb;
        }
        
        .quiz-option.incorrect {
            background: #f8d7da;
            border-color: #f5c6cb;
        }
        
        /* 三级页面样式 - 词库详情 */
        .lib-detail-container {
            display: flex;
            gap: 20px;
            margin-top: 20px;
        }
        
        .unit-list {
            width: 250px;
            background: #f8f9fa;
            border-radius: 15px;
            padding: 15px;
            max-height: 500px;
            overflow-y: auto;
        }
        
        .unit-item {
            padding: 12px;
            border-radius: 10px;
            margin-bottom: 8px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .unit-item:hover, .unit-item.active {
            background: #e9ecef;
        }
        
        .word-list-container {
            flex: 1;
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
        }
        
        .word-table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .word-table th {
            background: #f1f3f5;
            padding: 12px;
            text-align: left;
        }
        
        .word-table td {
            padding: 12px;
            border-bottom: 1px solid #eee;
        }
        
        /* 筛选区域 */
        .filter-section {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 20px;
            align-items: center;
        }
        
        .filter-item {
            display: flex;
            flex-direction: column;
            min-width: 200px;
        }
        
        .filter-item label {
            margin-bottom: 5px;
            font-weight: bold;
            color: #555;
        }
        
        .filter-item select, .filter-item input {
            padding: 10px;
            border-radius: 10px;
            border: 1px solid #ddd;
        }
        
        /* 记录卡片 */
        .record-card {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
        }
        
        .record-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .record-title {
            font-size: 1.2rem;
            font-weight: bold;
            color: var(--secondary);
        }
        
        .record-meta {
            display: flex;
            gap: 15px;
            color: #666;
        }
        
        .record-actions {
            display: flex;
            gap: 10px;
        }
        
        /* 学习计划样式 */
        .plan-student-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .plan-student-card {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .plan-student-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .plan-student-name {
            font-weight: bold;
            font-size: 1.2rem;
            color: var(--secondary);
        }
        
        .plan-actions {
            display: flex;
            gap: 10px;
        }
        
        .plan-calendar {
            margin-top: 20px;
        }
        
        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 10px;
            margin-top: 15px;
        }
        
        .calendar-day {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .calendar-day:hover {
            transform: translateY(-3px);
        }
        
        .calendar-date {
            font-weight: bold;
            margin-bottom: 5px;
            font-size: 0.9rem;
        }
        
        .calendar-status {
            font-size: 0.9rem;
            padding: 3px 8px;
            border-radius: 20px;
            display: inline-block;
            color: white;
        }
        
        .status-complete {
            background: var(--plan-complete);
        }
        
        .status-incomplete {
            background: var(--plan-incomplete);
        }
        
        .status-noclass {
            background: var(--plan-noclass);
        }
        
        .status-leave {
            background: var(--plan-leave);
        }
        
        /* 响应式设计 */
        @media (max-width: 992px) {
            .word-grid {
                grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            }
            
            .review-card {
                width: 100%;
            }
            
            .lib-detail-container {
                flex-direction: column;
            }
            
            .unit-list {
                width: 100%;
            }
            
            .plan-student-list {
                grid-template-columns: 1fr;
            }
        }
        
        @media (max-width: 768px) {
            .quiz-options {
                grid-template-columns: 1fr;
            }
            
            .word-grid {
                grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
            }
            
            .record-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }
            
            .record-meta {
                flex-direction: column;
                gap: 5px;
            }
            
            .calendar-grid {
                grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            }
        }
        
        @media (max-width: 480px) {
            .login-container h1 {
                font-size: 2.5rem;
            }
            
            .header h1 {
                font-size: 1.8rem;
            }
            
            .main-menu {
                grid-template-columns: 1fr;
            }
            
            .word-grid {
                grid-template-columns: 1fr;
            }
        }
        
        /* 模态框样式 */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        
        .modal-content {
            background: white;
            border-radius: 15px;
            padding: 25px;
            width: 90%;
            max-width: 600px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            max-height: 90vh;
            overflow-y: auto;
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .modal-title {
            font-size: 1.5rem;
            color: var(--secondary);
        }
        
        .close-btn {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #666;
        }
        
        .template-format {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 15px;
            margin: 15px 0;
            font-family: monospace;
        }
        
        /* 批量添加区域 */
        .batch-add-area {
            width: 100%;
            height: 200px;
            padding: 10px;
            border-radius: 10px;
            border: 1px solid #ddd;
            font-family: monospace;
            margin: 15px 0;
        }
        
        /* 报告样式 */
        .report-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin: 20px 0;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
        }
        
        .report-header {
            text-align: center;
            margin-bottom: 20px;
        }
        
        .report-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .stat-card {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 15px;
            text-align: center;
        }
        
        .word-list {
            margin-top: 20px;
        }
        
        .word-item {
            padding: 10px;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        /* 新增的筛选样式 */
        .filter-controls {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-top: 15px;
            align-items: center;
        }
        
        .filter-control {
            display: flex;
            flex-direction: column;
            min-width: 180px;
        }
        
        .filter-control label {
            font-weight: bold;
            margin-bottom: 5px;
            color: #555;
        }
        
        .filter-control select, .filter-control input {
            padding: 10px;
            border-radius: 10px;
            border: 1px solid #ddd;
        }
        
        .word-count-info {
            background: #f0f7ff;
            padding: 10px 15px;
            border-radius: 10px;
            font-size: 0.9rem;
            color: #4361ee;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- 登录页面 -->
        <div id="loginPage" class="login-container">
            <h1><i class="fas fa-book"></i> 单词带背系统</h1>
            <p>专为中小学生设计的智能单词学习工具，让背单词变得简单有趣！</p>
            
            <div class="password-box">
                <input type="password" id="passwordInput" placeholder="请输入系统密码">
                <button id="loginBtn">进入系统</button>
            </div>
        </div>
        
        <!-- 主页面 -->
        <div id="mainPage" class="page">
            <div class="header">
                <h1><i class="fas fa-book-open"></i> 单词带背系统</h1>
                <div id="userInfo">教育不是注满一桶水，而是点燃一把火。</div>
            </div>
            
            <div class="main-menu">
                <div class="menu-card" onclick="showPage('wordLibPage')">
                    <i class="fas fa-book"></i>
                    <h2>单词库</h2>
                    <p>创建和管理多个词库，导入词汇，增删改查操作</p>
                </div>
                
                <div class="menu-card" onclick="showPage('studentPage')">
                    <i class="fas fa-user-graduate"></i>
                    <h2>学员管理</h2>
                    <p>添加、修改和删除学员信息，设置学习计划</p>
                </div>
                
                <div class="menu-card" onclick="showPage('studyPlanPage')">
                    <i class="fas fa-calendar-alt"></i>
                    <h2>学习计划管理</h2>
                    <p>创建学习计划，标记完成情况，导出计划表</p>
                </div>
                
                <div class="menu-card" onclick="showPage('wordStudyPage')">
                    <i class="fas fa-brain"></i>
                    <h2>单词学习</h2>
                    <p>选择学员和词库，开始单词学习，记录学习情况</p>
                </div>
                
                <div class="menu-card" onclick="showPage('reviewPage')">
                    <i class="fas fa-sync-alt"></i>
                    <h2>抗遗忘复习</h2>
                    <p>通过多种方式复习单词，强化记忆效果</p>
                </div>
                
                <div class="menu-card" onclick="showPage('recordPage')">
                    <i class="fas fa-history"></i>
                    <h2>学习记录</h2>
                    <p>查看学习历史记录，导出学习报告</p>
                </div>
            </div>
        </div>
        
        <!-- 单词库页面 -->
        <div id="wordLibPage" class="page">
            <div class="header">
                <h1><i class="fas fa-book"></i> 单词库管理</h1>
                <div class="top-right-buttons">
                    <button class="back-btn" onclick="showPage('mainPage')"><i class="fas fa-home"></i> 返回首页</button>
                </div>
            </div>
            
            <div class="content">
                <div class="card">
                    <h3>创建新词库</h3>
                    <input type="text" id="newLibName" placeholder="输入词库名称" style="width:100%; padding:10px; margin-bottom:15px; border-radius:10px; border:1px solid #ddd;">
                    <button class="btn" onclick="createWordLib()"><i class="fas fa-plus"></i> 创建词库</button>
                </div>
                
                <div class="card">
                    <h3>我的词库</h3>
                    <div id="wordLibsContainer" style="display:grid; grid-template-columns:repeat(auto-fill, minmax(250px, 1fr)); gap:15px;">
                        <!-- 词库将通过JS动态生成 -->
                    </div>
                </div>
            </div>
        </div>
        
        <!-- 词库详情页面（三级页面） -->
        <div id="wordLibDetailPage" class="page">
            <div class="header">
                <h1 id="currentLibName">词库详情</h1>
                <div class="top-right-buttons">
                    <button class="back-btn" onclick="showPage('wordLibPage')"><i class="fas fa-arrow-left"></i> 返回词库</button>
                </div>
            </div>
            
            <div class="content">
                <div class="card">
                    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
                        <h3>单词管理</h3>
                        <div>
                            <button class="btn" onclick="showImportModal()"><i class="fas fa-file-import"></i> 导入单词</button>
                            <button class="btn" onclick="showBatchAddModal()"><i class="fas fa-plus-circle"></i> 批量添加</button>
                        </div>
                    </div>
                    
                    <div class="lib-detail-container">
                        <div class="unit-list">
                            <h4>单元列表</h4>
                            <div id="unitList">
                                <!-- 单元列表将通过JS动态生成 -->
                            </div>
                        </div>
                        
                        <div class="word-list-container">
                            <h4 id="currentUnitName">单词列表</h4>
                            <table class="word-table">
                                <thead>
                                    <tr>
                                        <th>单词</th>
                                        <th>中文</th>
                                        <th>音标</th>
                                        <th>操作</th>
                                    </tr>
                                </thead>
                                <tbody id="wordList">
                                    <!-- 单词列表将通过JS动态生成 -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- 学员管理页面 -->
        <div id="studentPage" class="page">
            <div class="header">
                <h1><i class="fas fa-user-graduate"></i> 学员管理</h1>
                <div class="top-right-buttons">
                    <button class="back-btn" onclick="showPage('mainPage')"><i class="fas fa-home"></i> 返回首页</button>
                </div>
            </div>
            
            <div class="content">
                <div class="card">
                    <h3>添加新学员</h3>
                    <div style="display:grid; grid-template-columns:repeat(auto-fill, minmax(250px, 1fr)); gap:15px;">
                        <input type="text" id="studentName" placeholder="姓名" style="padding:10px; border-radius:10px; border:1px solid #ddd;">
                        <input type="number" id="studentAge" placeholder="年龄" style="padding:10px; border-radius:10px; border:1px solid #ddd;">
                        <input type="text" id="studentGrade" placeholder="年级" style="padding:10px; border-radius:10px; border:1px solid #ddd;">
                        <input type="text" id="studentMaterial" placeholder="教材" style="padding:10px; border-radius:10px; border:1px solid #ddd;">
                    </div>
                    <button class="btn" style="margin-top:15px;" onclick="addStudent()"><i class="fas fa-user-plus"></i> 添加学员</button>
                </div>
                
                <div class="card">
                    <h3>学员列表</h3>
                    <table style="width:100%; border-collapse:collapse;">
                        <thead>
                            <tr style="background:#f1f3f5;">
                                <th style="padding:12px; text-align:left;">姓名</th>
                                <th style="padding:12px; text-align:left;">年龄</th>
                                <th style="padding:12px; text-align:left;">年级</th>
                                <th style="padding:12px; text-align:left;">教材</th>
                                <th style="padding:12px; text-align:left;">操作</th>
                            </tr>
                        </thead>
                        <tbody id="studentsList">
                            <!-- 学员列表将通过JS动态生成 -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        
        <!-- 单词学习页面 -->
        <div id="wordStudyPage" class="page">
            <div class="header">
                <h1><i class="fas fa-brain"></i> 单词学习</h1>
                <div class="top-right-buttons">
                    <button class="back-btn" onclick="showPage('mainPage')"><i class="fas fa-home"></i> 返回首页</button>
                </div>
            </div>
            
            <div class="content">
                <div class="card">
                    <h3>选择学员、词库和单元</h3>
                    <div style="display:flex; flex-wrap:wrap; gap:15px; margin-bottom:20px;">
                        <select id="studentSelect" style="padding:10px 15px; border-radius:10px; border:1px solid #ddd; flex:1; min-width:200px;">
                            <option value="">选择学员</option>
                        </select>
                        
                        <select id="wordLibSelect" style="padding:10px 15px; border-radius:10px; border:1px solid #ddd; flex:1; min-width:200px;">
                            <option value="">选择词库</option>
                        </select>
                        
                        <select id="unitSelect" style="padding:10px 15px; border-radius:10px; border:1px solid #ddd; flex:1; min-width:200px; display:none;">
                            <option value="">选择单元</option>
                        </select>
                    </div>
                    
                    <!-- 新增的筛选区域 -->
                    <div class="filter-controls">
                        <div class="filter-control">
                            <label for="wordStatus">词汇情况</label>
                            <select id="wordStatus">
                                <option value="all">全部词汇</option>
                                <option value="learned">已学词汇</option>
                                <option value="unlearned">未学词汇</option>
                            </select>
                        </div>
                        
                        <div class="filter-control">
                            <label for="wordCount">学习数量</label>
                            <input type="number" id="wordCount" placeholder="全部词汇" min="1">
                        </div>
                        
                        <div class="word-count-info" id="wordCountInfo">
                            总词汇: 0 | 已学: 0 | 未学: 0
                        </div>
                    </div>
                    
                    <button class="btn" style="min-width:120px; margin-top:15px;" onclick="startLearning()"><i class="fas fa-play"></i> 开始学习</button>
                </div>
                
                <div class="card" id="progressSection" style="display:none;">
                    <h3>学习进度</h3>
                    <div style="display:flex; justify-content:space-between; margin-bottom:10px;">
                        <div>总词汇: <span id="totalWords">0</span>个</div>
                        <div>已学习: <span id="learnedWords">0</span>个</div>
                        <div>进度: <span id="progressPercent">0</span>%</div>
                    </div>
                    <div class="progress-container">
                        <div class="progress-bar" id="progressBar" style="width:0%"></div>
                    </div>
                </div>
                
                <div class="card" id="wordStudySection" style="display:none;">
                    <h3>单词学习</h3>
                    <div class="word-grid" id="wordGrid">
                        <!-- 单词卡片将通过JS动态生成 -->
                    </div>
                    
                    <button class="btn" style="margin-top:20px; width:100%;" onclick="finishLearning()"><i class="fas fa-check-circle"></i> 完成学习</button>
                </div>
            </div>
        </div>
        
        <!-- 抗遗忘复习页面 -->
        <div id="reviewPage" class="page">
            <div class="header">
                <h1><i class="fas fa-sync-alt"></i> 抗遗忘复习</h1>
                <div class="top-right-buttons">
                    <button class="back-btn" onclick="showPage('mainPage')"><i class="fas fa-home"></i> 返回首页</button>
                </div>
            </div>
            
            <div class="content">
                <div class="card">
                    <h3>选择复习模式</h3>
                    <div class="review-container">
                        <div class="review-card" onclick="showReviewModal('wordToMeaning')">
                            <i class="fas fa-font"></i>
                            <h3>看词选义</h3>
                            <p>根据英文单词选择正确的中文释义</p>
                        </div>
                        
                        <div class="review-card" onclick="showReviewModal('meaningToWord')">
                            <i class="fas fa-language"></i>
                            <h3>看义选词</h3>
                            <p>根据中文释义选择正确的英文单词</p>
                        </div>
                        
                        <div class="review-card" onclick="showReviewModal('soundToWord')">
                            <i class="fas fa-volume-up"></i>
                            <h3>听音选词</h3>
                            <p>根据单词发音选择正确的英文单词</p>
                        </div>
                        
                        <div class="review-card" onclick="showPage('vocabularyBookPage')">
                            <i class="fas fa-book"></i>
                            <h3>生字本</h3>
                            <p>查看和管理学生的生词本</p>
                        </div>
                    </div>
                </div>
                
                <div class="card" id="quizSection" style="display:none;">
                    <h3>复习测试</h3>
                    <div id="quizArea" class="quiz-area">
                        <!-- 答题区域将通过JS动态生成 -->
                    </div>
                    
                    <div style="display:flex; justify-content:space-between; margin-top:20px;">
                        <div>答题数量: <span id="quizCount">0</span>/<span id="totalQuiz">0</span></div>
                        <div>答对: <span id="correctCount">0</span> 答错: <span id="wrongCount">0</span></div>
                    </div>
                    
                    <button class="btn" style="margin-top:20px; width:100%;" onclick="finishQuiz()"><i class="fas fa-flag-checkered"></i> 完成复习</button>
                </div>
            </div>
        </div>
        
        <!-- 学习计划管理页面 -->
        <div id="studyPlanPage" class="page">
            <div class="header">
                <h1><i class="fas fa-calendar-alt"></i> 学习计划管理</h1>
                <div class="top-right-buttons">
                    <button class="back-btn" onclick="showPage('mainPage')"><i class="fas fa-home"></i> 返回首页</button>
                </div>
            </div>
            
            <div class="content">
                <div class="card">
                    <h3>学员学习计划</h3>
                    <div class="plan-student-list" id="planStudentList">
                        <!-- 学员计划列表将通过JS动态生成 -->
                    </div>
                </div>
                
                <div class="card" id="planDetailSection" style="display:none;">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <h3 id="planStudentName">学习计划详情</h3>
                        <div id="planDateRange" style="color: #666; font-size: 1rem;"></div>
                    </div>
                    <div class="plan-calendar">
                        <div id="calendarGrid" class="calendar-grid">
                            <!-- 日历视图将通过JS动态生成 -->
                        </div>
                    </div>
                    
                    <button class="btn" style="margin-top:20px;" onclick="exportPlanToPDF()"><i class="fas fa-file-export"></i> 导出计划表</button>
                </div>
            </div>
        </div>
        
        <!-- 学习记录页面 -->
        <div id="recordPage" class="page">
            <div class="header">
                <h1><i class="fas fa-history"></i> 学习记录</h1>
                <div class="top-right-buttons">
                    <button class="back-btn" onclick="showPage('mainPage')"><i class="fas fa-home"></i> 返回首页</button>
                </div>
            </div>
            
            <div class="content">
                <div class="card">
                    <h3>记录筛选</h3>
                    <div class="filter-section">
                        <div class="filter-item">
                            <label for="recordStudent">学员</label>
                            <select id="recordStudent">
                                <option value="">所有学员</option>
                            </select>
                        </div>
                        
                        <div class="filter-item">
                            <label for="recordType">记录类型</label>
                            <select id="recordType">
                                <option value="">所有类型</option>
                                <option value="learning">单词学习</option>
                                <option value="review">抗遗忘复习</option>
                            </select>
                        </div>
                        
                        <div class="filter-item">
                            <label for="startDate">开始日期</label>
                            <input type="date" id="startDate">
                        </div>
                        
                        <div class="filter-item">
                            <label for="endDate">结束日期</label>
                            <input type="date" id="endDate">
                        </div>
                        
                        <button class="btn" style="align-self:flex-end;" onclick="filterRecords()"><i class="fas fa-filter"></i> 筛选</button>
                    </div>
                </div>
                
                <div class="card">
                    <h3>学习记录列表</h3>
                    <div id="recordList">
                        <!-- 记录列表将通过JS动态生成 -->
                    </div>
                </div>
            </div>
        </div>
        
        <!-- 生字本页面 -->
        <div id="vocabularyBookPage" class="page">
            <div class="header">
                <h1><i class="fas fa-book"></i> 生字本管理</h1>
                <div class="top-right-buttons">
                    <button class="back-btn" onclick="showPage('reviewPage')"><i class="fas fa-arrow-left"></i> 返回复习</button>
                </div>
            </div>
            <div class="content">
                <div class="card">
                    <h3>学生生字本</h3>
                    <div id="vocabBooks">
                        <!-- 生字本列表将通过JS动态生成 -->
                    </div>
                </div>
            </div>
        </div>
        
        <!-- 导入单词模态框 -->
        <div id="importModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <div class="modal-title">导入单词</div>
                    <button class="close-btn" onclick="closeModal()">&times;</button>
                </div>
                
                <div class="card">
                    <h4>导入格式要求</h4>
                    <p>请使用Excel文件导入，文件格式要求如下：</p>
                    <div class="template-format">
                        单元,英文,中文,音标<br>
                        Unit 1,apple,苹果,/ˈæpl/<br>
                        Unit 1,book,书,/bʊk/<br>
                        Unit 2,computer,电脑,/kəmˈpjuːtər/
                    </div>
                    
                    <button class="btn" style="width:100%; margin:15px 0;" onclick="downloadTemplate()">
                        <i class="fas fa-download"></i> 下载模板
                    </button>
                    
                    <div style="margin:15px 0;">
                        <label>选择Excel文件</label>
                        <input type="file" accept=".xlsx,.xls" style="width:100%; padding:10px; margin-top:5px;">
                    </div>
                    
                    <button class="btn" style="width:100%;" onclick="importWords()">
                        <i class="fas fa-upload"></i> 导入单词
                    </button>
                </div>
            </div>
        </div>
        
        <!-- 批量添加单词模态框 -->
        <div id="batchAddModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <div class="modal-title">批量添加单词</div>
                    <button class="close-btn" onclick="closeModal()">&times;</button>
                </div>
                
                <div class="card">
                    <h4>添加单词</h4>
                    <div style="margin:10px 0;">
                        <label>单元名称</label>
                        <input type="text" id="unitName" placeholder="输入单元名称" style="width:100%; padding:10px; border-radius:10px; border:1px solid #ddd;">
                    </div>
                    
                    <div style="margin:15px 0;">
                        <label>单词列表（每行格式：单词,中文,音标）</label>
                        <textarea class="batch-add-area" placeholder="apple,苹果,/ˈæpl/&#10;book,书,/bʊk/&#10;computer,电脑,/kəmˈpjuːtər/"></textarea>
                    </div>
                    
                    <button class="btn" style="width:100%;" onclick="batchAddWords()"><i class="fas fa-plus"></i> 添加单词</button>
                </div>
            </div>
        </div>
        
        <!-- 复习模式选择模态框 -->
        <div id="reviewModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <div class="modal-title">开始复习</div>
                    <button class="close-btn" onclick="closeModal()">&times;</button>
                </div>
                
                <div class="card">
                    <h4>选择复习设置</h4>
                    
                    <div style="margin:15px 0;">
                        <label>选择学员</label>
                        <select id="reviewStudent" style="width:100%; padding:10px; border-radius:10px; border:1px solid #ddd;">
                            <option value="">选择学员</option>
                        </select>
                    </div>
                    
                    <div style="margin:15px 0;">
                        <label>词汇来源</label>
                        <div style="display:flex; gap:15px; margin-top:10px;">
                            <label style="display:flex; align-items:center; gap:5px;">
                                <input type="radio" name="reviewSource" value="vocabularyBook" checked> 生词本
                            </label>
                            <label style="display:flex; align-items:center; gap:5px;">
                                <input type="radio" name="reviewSource" value="wordLib"> 单词库
                            </label>
                        </div>
                    </div>
                    
                    <div id="libSelection" style="display:none; margin:15px 0;">
                        <label>选择词库</label>
                        <select id="reviewLib" style="width:100%; padding:10px; border-radius:10px; border:1px solid #ddd; margin-bottom:15px;">
                            <option value="">选择词库</option>
                        </select>
                        
                        <label>选择单元</label>
                        <select id="reviewUnit" style="width:100%; padding:10px; border-radius:10px; border:1px solid #ddd;">
                            <option value="">选择单元</option>
                        </select>
                    </div>
                    
                    <!-- 新增复习筛选区域 -->
                    <div id="reviewFilterSection" style="margin:15px 0; display:none;">
                        <div class="filter-control">
                            <label for="reviewWordStatus">词汇情况</label>
                            <select id="reviewWordStatus">
                                <option value="all">全部词汇</option>
                                <option value="learned">已学词汇</option>
                                <option value="unlearned">未学词汇</option>
                            </select>
                        </div>
                        
                        <div class="filter-control">
                            <label for="reviewWordCount">复习数量</label>
                            <input type="number" id="reviewWordCount" placeholder="全部词汇" min="1">
                        </div>
                        
                        <div class="word-count-info" id="reviewWordCountInfo">
                            总词汇: 0 | 已学: 0 | 未学: 0
                        </div>
                    </div>
                    
                    <button class="btn" id="startReviewBtn" style="width:100%; margin-top:15px;" onclick="startReview()"><i class="fas fa-play"></i> 开始复习</button>
                </div>
            </div>
        </div>
        
        <!-- 创建学习计划模态框 -->
        <div id="createPlanModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <div class="modal-title">创建学习计划</div>
                    <button class="close-btn" onclick="closeModal()">&times;</button>
                </div>
                
                <div class="card">
                    <div style="margin:15px 0;">
                        <label>开始日期</label>
                        <input type="date" id="planStartDate" style="width:100%; padding:10px; border-radius:10px; border:1px solid #ddd; margin-top:5px;">
                    </div>
                    
                    <div style="margin:15px 0;">
                        <label>结束日期</label>
                        <input type="date" id="planEndDate" style="width:100%; padding:10px; border-radius:10px; border:1px solid #ddd; margin-top:5px;">
                    </div>
                    
                    <button class="btn" id="createPlanBtn" style="width:100%; margin-top:15px;" onclick="createStudyPlan()"><i class="fas fa-calendar-plus"></i> 创建计划</button>
                </div>
            </div>
        </div>
        
        <!-- 学习报告页面 -->
        <div id="reportPage" class="page">
            <div class="header">
                <h1><i class="fas fa-file-pdf"></i> 学习报告</h1>
                <div class="top-right-buttons">
                    <button class="back-btn" id="reportBackBtn"><i class="fas fa-arrow-left"></i> 返回</button>
                </div>
            </div>
            <div class="content">
                <div id="reportContent">
                    <!-- 报告内容将通过JS动态生成 -->
                </div>
                
                <button class="btn" style="margin-top:20px; width:100%;" onclick="exportToPDF()"><i class="fas fa-file-export"></i> 导出PDF报告</button>
            </div>
        </div>
    </div>
    
    <script>
        // 系统数据模型
        const systemData = {
            wordLibs: [],
            students: [],
            studyPlans: {},
            learningRecords: [],
            vocabularyBooks: {},
            currentSession: null,
            currentLib: null,
            currentUnit: null,
            currentPlanStudent: null
        };
        
        // 初始化系统数据
        function initSystemData() {
            const savedData = localStorage.getItem('wordRecitationSystem');
            if (savedData) {
                try {
                    const parsedData = JSON.parse(savedData);
                    systemData.wordLibs = parsedData.wordLibs || [];
                    systemData.students = parsedData.students || [];
                    systemData.studyPlans = parsedData.studyPlans || {};
                    systemData.learningRecords = parsedData.learningRecords || [];
                    systemData.vocabularyBooks = parsedData.vocabularyBooks || {};
                } catch (e) {
                    console.error("解析保存数据时出错:", e);
                    resetSystemData();
                }
            } else {
                resetSystemData();
            }
            
            systemData.currentSession = null;
            systemData.currentLib = null;
            systemData.currentUnit = null;
            systemData.currentPlanStudent = null;
        }
        
        function resetSystemData() {
            systemData.wordLibs = [];
            systemData.students = [];
            systemData.studyPlans = {};
            systemData.learningRecords = [];
            systemData.vocabularyBooks = {};
        }
        
        // 保存系统数据到localStorage
        function saveSystemData() {
            const dataToSave = {
                wordLibs: systemData.wordLibs,
                students: systemData.students,
                studyPlans: systemData.studyPlans,
                learningRecords: systemData.learningRecords,
                vocabularyBooks: systemData.vocabularyBooks
            };
            
            localStorage.setItem('wordRecitationSystem', JSON.stringify(dataToSave));
        }
        
        // 密码验证逻辑
        document.getElementById('loginBtn').addEventListener('click', function() {
            const password = document.getElementById('passwordInput').value;
            
            // 简单加密的密码验证
            const encryptedPassword = btoa(String.fromCharCode(...[50, 56, 54, 49]));
            const inputEncrypted = btoa(password);
            
            if (inputEncrypted === encryptedPassword) {
                document.getElementById('loginPage').style.display = 'none';
                document.getElementById('mainPage').style.display = 'block';
                initSystemData();
                renderStudents();
                renderWordLibs();
                populateRecordStudents();
                renderStudyPlans();
            } else {
                alert('密码错误！请输入正确密码');
            }
        });
        
        // 页面导航函数
        function showPage(pageId) {
            const pages = document.querySelectorAll('.page');
            pages.forEach(page => {
                page.style.display = 'none';
            });
            document.getElementById(pageId).style.display = 'block';
            
            // 特殊页面的初始化
            if (pageId === 'studentPage') {
                renderStudents();
            } else if (pageId === 'wordLibPage') {
                renderWordLibs();
            } else if (pageId === 'wordStudyPage') {
                populateStudentSelect();
                populateWordLibSelect();
            } else if (pageId === 'reviewPage') {
                populateReviewStudentSelect();
            } else if (pageId === 'recordPage') {
                renderRecords();
            } else if (pageId === 'vocabularyBookPage') {
                renderVocabularyBooks();
            } else if (pageId === 'studyPlanPage') {
                renderStudyPlans();
            }
        }
        
        // 渲染学员列表
        function renderStudents() {
            const container = document.getElementById('studentsList');
            container.innerHTML = '';
            
            systemData.students.forEach(student => {
                const row = document.createElement('tr');
                row.style.borderBottom = '1px solid #eee';
                row.innerHTML = `
                    <td style="padding:12px;">${student.name}</td>
                    <td style="padding:12px;">${student.age}</td>
                    <td style="padding:12px;">${student.grade}</td>
                    <td style="padding:12px;">${student.material}</td>
                    <td style="padding:12px;">
                        <button class="btn" onclick="editStudent('${student.id}')">编辑</button>
                        <button class="btn btn-danger" onclick="deleteStudent('${student.id}')">删除</button>
                    </td>
                `;
                container.appendChild(row);
            });
        }
        
        function createWordLib() {
            const name = document.getElementById('newLibName').value;
            if (!name) {
                alert('请输入词库名称');
                return;
            }
            
            const newLib = {
                id: 'lib' + Date.now(),
                name,
                units: []
            };
            
            systemData.wordLibs.push(newLib);
            saveSystemData();
            
            // 修复：创建后立即设置为当前词库
            systemData.currentLib = newLib;
            
            // 修复：跳转到新词库详情页并清空单元列表
            document.getElementById('currentLibName').textContent = newLib.name;
            showPage('wordLibDetailPage');
            document.getElementById('unitList').innerHTML = '';
            document.getElementById('wordList').innerHTML = '<tr><td colspan="4" style="text-align:center; padding:20px; color:#666;">该单元暂无单词</td></tr>';
            
            document.getElementById('newLibName').value = '';
        }
        
        function renderWordLibs() {
            const container = document.getElementById('wordLibsContainer');
            if (!container) return;
            
            container.innerHTML = '';
            
            if (!systemData.wordLibs || systemData.wordLibs.length === 0) {
                container.innerHTML = `
                    <div style="text-align:center; padding:30px; color:#666; background:#f8f9fa; border-radius:10px;">
                        <i class="fas fa-book" style="font-size:2rem; margin-bottom:10px; color:var(--secondary);"></i>
                        <p>暂无词库，请创建新词库</p>
                    </div>
                `;
                return;
            }
            
            systemData.wordLibs.forEach(lib => {
                let totalWords = 0;
                if (lib.units && Array.isArray(lib.units)) {
                    lib.units.forEach(unit => {
                        totalWords += unit.words ? unit.words.length : 0;
                    });
                }
                
                const libCard = document.createElement('div');
                libCard.className = 'lib-card';
                libCard.innerHTML = `
                    <h4>${lib.name}</h4>
                    <p><i class="fas fa-layer-group"></i> ${lib.units?.length || 0} 个单元 | <i class="fas fa-book"></i> ${totalWords} 个单词</p>
                    <div style="display:flex; gap:10px; margin-top:15px;">
                        <button class="btn" onclick="manageWordLib('${lib.id}')">
                            <i class="fas fa-edit"></i> 管理
                        </button>
                        <button class="btn btn-danger" onclick="deleteWordLib('${lib.id}')">
                            <i class="fas fa-trash"></i> 删除
                        </button>
                    </div>
                `;
                container.appendChild(libCard);
            });
        }
        
        // 管理词库
        function manageWordLib(libId) {
            const lib = systemData.wordLibs.find(l => l.id === libId);
            if (!lib) return;
            
            systemData.currentLib = lib;
            document.getElementById('currentLibName').textContent = lib.name;
            showPage('wordLibDetailPage');
            
            // 修复：清空之前显示的单词列表
            document.getElementById('wordList').innerHTML = '';
            
            renderUnitList();
        }
        
        // 删除词库
        function deleteWordLib(libId) {
            if (!confirm('确定要删除这个词库吗？此操作不可恢复。')) return;
            
            systemData.wordLibs = systemData.wordLibs.filter(lib => lib.id !== libId);
            saveSystemData();
            renderWordLibs();
        }
        
        // 渲染单元列表
        function renderUnitList() {
            if (!systemData.currentLib || !Array.isArray(systemData.currentLib.units)) return;
            
            const container = document.getElementById('unitList');
            container.innerHTML = '';
            
            systemData.currentLib.units.forEach((unit, index) => {
                const unitItem = document.createElement('div');
                unitItem.className = 'unit-item';
                unitItem.textContent = unit.name || `单元 ${index + 1}`;
                unitItem.onclick = () => {
                    document.querySelectorAll('.unit-item').forEach(item => {
                        item.classList.remove('active');
                    });
                    unitItem.classList.add('active');
                    renderWordList(unit.name || `单元 ${index + 1}`);
                };
                
                if (index === 0) {
                    unitItem.classList.add('active');
                    renderWordList(unit.name || `单元 ${index + 1}`);
                }
                
                container.appendChild(unitItem);
            });
        }
        
        // 渲染单词列表
        function renderWordList(unitName) {
            if (!systemData.currentLib || !Array.isArray(systemData.currentLib.units)) return;
            
            const unit = systemData.currentLib.units.find(u => u.name === unitName);
            if (!unit) return;
            
            document.getElementById('currentUnitName').textContent = `${unit.name} - 单词列表`;
            
            const container = document.getElementById('wordList');
            container.innerHTML = '';
            
            if (!unit.words || unit.words.length === 0) {
                container.innerHTML = `
                    <tr>
                        <td colspan="4" style="text-align:center; padding:20px; color:#666;">
                            该单元暂无单词
                        </td>
                    </tr>
                `;
                return;
            }
            
            unit.words.forEach(word => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td onclick="speakWord('${word.english}')">${word.english}</td>
                    <td>${word.chinese}</td>
                    <td>${word.phonetic}</td>
                    <td>
                        <button class="btn btn-danger" onclick="deleteWord('${word.id}')">删除</button>
                    </td>
                `;
                container.appendChild(row);
            });
        }
        
        // 删除单词
        function deleteWord(wordId) {
            if (!systemData.currentLib || !Array.isArray(systemData.currentLib.units)) return;
            
            for (const unit of systemData.currentLib.units) {
                if (unit.words && Array.isArray(unit.words)) {
                    const index = unit.words.findIndex(w => w.id === wordId);
                    if (index !== -1) {
                        unit.words.splice(index, 1);
                        saveSystemData();
                        renderWordList(unit.name);
                        return;
                    }
                }
            }
        }
        
        // 显示导入模态框
        function showImportModal() {
            document.getElementById('importModal').style.display = 'flex';
        }
        
        // 显示批量添加模态框
        function showBatchAddModal() {
            document.getElementById('batchAddModal').style.display = 'flex';
        }
        
        // 下载模板函数
        function downloadTemplate() {
            const wb = XLSX.utils.book_new();
            const data = [
                ['单元', '英文', '中文', '音标'],
                ['Unit 1', 'apple', '苹果', '/ˈæpl/'],
                ['Unit 1', 'book', '书', '/bʊk/'],
                ['Unit 2', 'computer', '电脑', '/kəmˈpjuːtər/']
            ];
            const ws = XLSX.utils.aoa_to_sheet(data);
            XLSX.utils.book_append_sheet(wb, ws, '单词模板');
            XLSX.writeFile(wb, '单词导入模板.xlsx');
        }
        
        // 单词导入函数
        function importWords() {
            const fileInput = document.querySelector('#importModal input[type="file"]');
            if (!fileInput.files.length) {
                alert('请选择文件');
                return;
            }
            
            const file = fileInput.files[0];
            const reader = new FileReader();
            
            reader.onload = function(e) {
                try {
                    const data = new Uint8Array(e.target.result);
                    const workbook = XLSX.read(data, {type: 'array'});
                    const firstSheetName = workbook.SheetNames[0];
                    const worksheet = workbook.Sheets[firstSheetName];
                    const jsonData = XLSX.utils.sheet_to_json(worksheet, {header:1});
                    
                    let addedCount = 0;
                    for (let i = 1; i < jsonData.length; i++) {
                        const row = jsonData[i];
                        if (row.length < 4) continue;
                        
                        const unitName = row[0] ? String(row[0]).trim() : '';
                        const english = row[1] ? String(row[1]).trim() : '';
                        const chinese = row[2] ? String(row[2]).trim() : '';
                        const phonetic = row[3] ? String(row[3]).trim() : '';
                        
                        if (unitName && english && chinese && phonetic) {
                            let unit = systemData.currentLib.units.find(u => u.name === unitName);
                            if (!unit) {
                                unit = { name: unitName, words: [] };
                                systemData.currentLib.units.push(unit);
                            }
                            
                            unit.words.push({
                                id: 'w' + Date.now() + Math.random().toString(36).substr(2, 5),
                                english,
                                chinese,
                                phonetic,
                                known: false,
                                learned: 0
                            });
                            addedCount++;
                        }
                    }
                    
                    saveSystemData();
                    closeModal();
                    renderUnitList();
                    alert(`成功导入${addedCount}个单词`);
                } catch (e) {
                    console.error(e);
                    alert('导入失败，文件格式错误');
                }
            };
            
            reader.readAsArrayBuffer(file);
        }
        
        // 批量添加单词
        function batchAddWords() {
            const unitName = document.getElementById('unitName').value;
            const wordText = document.querySelector('.batch-add-area').value;
            
            if (!unitName || !wordText) {
                alert('请填写单元名称和单词内容');
                return;
            }
            
            if (!systemData.currentLib || !Array.isArray(systemData.currentLib.units)) return;
            
            let unit = systemData.currentLib.units.find(u => u.name === unitName);
            if (!unit) {
                unit = {
                    name: unitName,
                    words: []
                };
                systemData.currentLib.units.push(unit);
            }
            
            const lines = wordText.split('\n');
            let addedCount = 0;
            
            lines.forEach(line => {
                const [english, chinese, phonetic] = line.split(',').map(item => item.trim());
                if (english && chinese && phonetic) {
                    unit.words.push({
                        id: 'w' + Date.now() + Math.random().toString(36).substr(2, 5),
                        english,
                        chinese,
                        phonetic,
                        known: false,
                        learned: 0
                    });
                    addedCount++;
                }
            });
            
            saveSystemData();
            closeModal();
            renderUnitList();
            renderWordList(unitName);
            alert(`成功添加${addedCount}个单词到${unitName}单元`);
        }
        
        // 添加学员
        function addStudent() {
            const name = document.getElementById('studentName').value;
            const age = document.getElementById('studentAge').value;
            const grade = document.getElementById('studentGrade').value;
            const material = document.getElementById('studentMaterial').value;
            
            if (!name || !age || !grade || !material) {
                alert('请填写所有学员信息');
                return;
            }
            
            const newStudent = {
                id: 's' + Date.now(),
                name,
                age: parseInt(age),
                grade,
                material
            };
            
            systemData.students.push(newStudent);
            systemData.vocabularyBooks[newStudent.id] = [];
            systemData.studyPlans[newStudent.id] = [];
            saveSystemData();
            renderStudents();
            populateStudentSelect();
            populateReviewStudentSelect();
            populateRecordStudents();
            renderStudyPlans();
            
            // 清空表单
            document.getElementById('studentName').value = '';
            document.getElementById('studentAge').value = '';
            document.getElementById('studentGrade').value = '';
            document.getElementById('studentMaterial').value = '';
        }
        
        // 编辑学员
        function editStudent(studentId) {
            const student = systemData.students.find(s => s.id === studentId);
            if (student) {
                document.getElementById('studentName').value = student.name;
                document.getElementById('studentAge').value = student.age;
                document.getElementById('studentGrade').value = student.grade;
                document.getElementById('studentMaterial').value = student.material;
                
                // 删除原学员
                deleteStudent(studentId);
            }
        }
        
        // 删除学员
        function deleteStudent(studentId) {
            systemData.students = systemData.students.filter(s => s.id !== studentId);
            saveSystemData();
            renderStudents();
            populateStudentSelect();
            populateReviewStudentSelect();
            populateRecordStudents();
            renderStudyPlans();
        }
        
        // 填充学员选择下拉框
        function populateStudentSelect() {
            const select = document.getElementById('studentSelect');
            select.innerHTML = '<option value="">选择学员</option>';
            
            systemData.students.forEach(student => {
                const option = document.createElement('option');
                option.value = student.id;
                option.textContent = student.name;
                select.appendChild(option);
            });
        }
        
        // 填充词库选择下拉框
        function populateWordLibSelect() {
            const select = document.getElementById('wordLibSelect');
            select.innerHTML = '<option value="">选择词库</option>';
            
            systemData.wordLibs.forEach(lib => {
                const option = document.createElement('option');
                option.value = lib.id;
                option.textContent = lib.name;
                select.appendChild(option);
            });
            
            // 监听词库选择变化
            select.onchange = function() {
                const unitSelect = document.getElementById('unitSelect');
                unitSelect.innerHTML = '<option value="">选择单元</option>';
                unitSelect.style.display = 'block';
                
                const selectedLib = systemData.wordLibs.find(lib => lib.id === this.value);
                if (selectedLib && selectedLib.units) {
                    selectedLib.units.forEach(unit => {
                        const option = document.createElement('option');
                        option.value = unit.name;
                        option.textContent = unit.name;
                        unitSelect.appendChild(option);
                    });
                    
                    // 重置筛选区域
                    document.getElementById('wordCountInfo').textContent = '总词汇: 0 | 已学: 0 | 未学: 0';
                }
            };
            
            // 监听单元选择变化
            document.getElementById('unitSelect').addEventListener('change', function() {
                const studentId = document.getElementById('studentSelect').value;
                const libId = document.getElementById('wordLibSelect').value;
                const unitName = this.value;
                
                if (!studentId || !libId || !unitName) return;
                
                // 更新词汇统计信息
                updateWordStats(studentId, libId, unitName);
            });
        }
        
        // 更新词汇统计信息（单词学习页面）
        function updateWordStats(studentId, libId, unitName) {
            const wordLib = systemData.wordLibs.find(lib => lib.id === libId);
            if (!wordLib) return;
            
            const unit = wordLib.units.find(u => u.name === unitName);
            if (!unit || !unit.words) return;
            
            // 计算各种状态的词汇数量
            let totalWords = unit.words.length;
            let learnedWords = 0;
            let unlearnedWords = 0;
            
            unit.words.forEach(word => {
                if (word.learned > 0) {
                    learnedWords++;
                } else {
                    unlearnedWords++;
                }
            });
            
            // 更新统计信息显示
            document.getElementById('wordCountInfo').textContent = 
                `总词汇: ${totalWords} | 已学: ${learnedWords} | 未学: ${unlearnedWords}`;
        }
        
        // 填充复习学员选择下拉框
        function populateReviewStudentSelect() {
            const select = document.getElementById('reviewStudent');
            select.innerHTML = '<option value="">选择学员</option>';
            
            systemData.students.forEach(student => {
                const option = document.createElement('option');
                option.value = student.id;
                option.textContent = student.name;
                select.appendChild(option);
            });
        }
        
        // 填充记录学员选择下拉框
        function populateRecordStudents() {
            const select = document.getElementById('recordStudent');
            select.innerHTML = '<option value="">所有学员</option>';
            
            systemData.students.forEach(student => {
                const option = document.createElement('option');
                option.value = student.id;
                option.textContent = student.name;
                select.appendChild(option);
            });
        }
        
        // 渲染学习计划
        function renderStudyPlans() {
            const container = document.getElementById('planStudentList');
            container.innerHTML = '';
            
            systemData.students.forEach(student => {
                const plans = systemData.studyPlans[student.id] || [];
                
                const card = document.createElement('div');
                card.className = 'plan-student-card';
                card.innerHTML = `
                    <div class="plan-student-header">
                        <div class="plan-student-name">${student.name}</div>
                        <div class="plan-actions">
                            <button class="btn" onclick="showCreatePlanModal('${student.id}')"><i class="fas fa-plus"></i> 创建计划</button>
                            <button class="btn" onclick="viewStudyPlan('${student.id}')"><i class="fas fa-eye"></i> 查看计划</button>
                        </div>
                    </div>
                    <div>已有计划: ${plans.length}个</div>
                `;
                container.appendChild(card);
            });
        }
        
        // 显示创建计划模态框
        function showCreatePlanModal(studentId) {
            systemData.currentPlanStudent = studentId;
            document.getElementById('createPlanModal').style.display = 'flex';
        }
        
        // 创建学习计划
        function createStudyPlan() {
            const studentId = systemData.currentPlanStudent;
            const startDate = document.getElementById('planStartDate').value;
            const endDate = document.getElementById('planEndDate').value;
            
            if (!studentId || !startDate || !endDate) {
                alert('请填写计划起止日期');
                return;
            }
            
            const start = new Date(startDate);
            const end = new Date(endDate);
            
            if (start > end) {
                alert('开始日期不能晚于结束日期');
                return;
            }
            
            // 计算天数
            const days = Math.ceil((end - start) / (1000 * 60 * 60 * 24)) + 1;
            
            // 创建计划
            const plan = {
                id: 'p' + Date.now(),
                startDate: start.toISOString().split('T')[0],
                endDate: end.toISOString().split('T')[0],
                days: days,
                status: {}
            };
            
            // 初始化每天的状态为未完成
            for (let i = 0; i < days; i++) {
                const date = new Date(start);
                date.setDate(start.getDate() + i);
                const dateStr = date.toISOString().split('T')[0];
                plan.status[dateStr] = 'incomplete';
            }
            
            // 确保学习计划数组存在
            if (!systemData.studyPlans[studentId]) {
                systemData.studyPlans[studentId] = [];
            }
            
            systemData.studyPlans[studentId].push(plan);
            saveSystemData();
            closeModal();
            
            // 刷新学习计划列表
            renderStudyPlans();
            
            alert(`成功创建${days}天的学习计划`);
        }
        
        // 查看学习计划
        function viewStudyPlan(studentId) {
            const student = systemData.students.find(s => s.id === studentId);
            if (!student) return;
            
            systemData.currentPlanStudent = studentId;
            document.getElementById('planDetailSection').style.display = 'block';
            document.getElementById('planStudentName').textContent = `${student.name}的学习计划`;
            
            renderCalendar();
        }
        
        // 渲染日历视图
        function renderCalendar() {
            const container = document.getElementById('calendarGrid');
            container.innerHTML = '';
            
            const plans = systemData.studyPlans[systemData.currentPlanStudent] || [];
            if (plans.length === 0) {
                container.innerHTML = '<div style="text-align:center; padding:20px; color:#666;">该学员暂无学习计划</div>';
                return;
            }
            
            // 只显示最新的计划
            const plan = plans[plans.length - 1];
            const startDate = new Date(plan.startDate);
            const endDate = new Date(plan.endDate);
            const days = plan.days;
            
            // 更新日期范围显示
            const dateRange = `${startDate.getFullYear()}/${startDate.getMonth()+1}/${startDate.getDate()} - ${endDate.getFullYear()}/${endDate.getMonth()+1}/${endDate.getDate()}`;
            document.getElementById('planDateRange').textContent = dateRange;
            
            // 状态顺序
            const statusOrder = ['incomplete', 'complete', 'noclass', 'leave'];
            
            for (let i = 0; i < days; i++) {
                const date = new Date(startDate);
                date.setDate(startDate.getDate() + i);
                const dateStr = date.toISOString().split('T')[0];
                let status = plan.status[dateStr] || 'incomplete';
                
                const dayCard = document.createElement('div');
                dayCard.className = 'calendar-day';
                dayCard.innerHTML = `
                    <div class="calendar-date">${date.getFullYear()}/${date.getMonth()+1}/${date.getDate()}</div>
                    <div class="calendar-status status-${status}" id="status-${dateStr}">
                        ${status === 'complete' ? '已完成' : 
                          status === 'incomplete' ? '未完成' : 
                          status === 'noclass' ? '无课' : 
                          '请假'}
                    </div>
                `;
                
                dayCard.onclick = () => {
                    // 获取当前状态索引
                    const currentStatus = plan.status[dateStr] || 'incomplete';
                    const currentIndex = statusOrder.indexOf(currentStatus);
                    
                    // 计算下一个状态
                    const nextIndex = (currentIndex + 1) % statusOrder.length;
                    const nextStatus = statusOrder[nextIndex];
                    
                    // 更新状态
                    plan.status[dateStr] = nextStatus;
                    saveSystemData();
                    
                    // 更新UI
                    const statusElement = document.getElementById(`status-${dateStr}`);
                    statusElement.className = `calendar-status status-${nextStatus}`;
                    statusElement.textContent = 
                        nextStatus === 'complete' ? '已完成' : 
                        nextStatus === 'incomplete' ? '未完成' : 
                        nextStatus === 'noclass' ? '无课' : '请假';
                };
                
                container.appendChild(dayCard);
            }
        }
        
        // 导出计划表
        function exportPlanToPDF() {
            const student = systemData.students.find(s => s.id === systemData.currentPlanStudent);
            const plans = systemData.studyPlans[systemData.currentPlanStudent] || [];
            
            if (plans.length === 0) {
                alert('该学员没有学习计划');
                return;
            }
            
            const plan = plans[plans.length - 1];
            const startDate = new Date(plan.startDate);
            const endDate = new Date(plan.endDate);
            
            // 创建PDF
            const pdf = new jspdf.jsPDF('p', 'mm', 'a4');
            
            // 添加标题
            pdf.setFontSize(18);
            pdf.text(`${student.name}'s Study Plan`, 105, 20, null, null, 'center');
            
            // 添加时间段
            pdf.setFontSize(14);
            const dateRange = `${startDate.getFullYear()}/${startDate.getMonth()+1}/${startDate.getDate()} - ${endDate.getFullYear()}/${endDate.getMonth()+1}/${endDate.getDate()}`;
            pdf.text(`Date Range: ${dateRange}`, 105, 30, null, null, 'center');
            
            // 状态图例
            pdf.setFontSize(12);
            pdf.text("Status Key:", 20, 45);
            pdf.text("✔ Completed", 60, 45);
            pdf.text("✘ Incomplete", 100, 45);
            pdf.text("— No Class", 140, 45);
            pdf.text("↗ Leave", 180, 45);
            
            let y = 55;
            
            // 添加表格标题
            pdf.setFontSize(12);
            pdf.text("Date", 20, y);
            pdf.text("Status", 100, y);
            y += 7;
            
            // 添加表格内容
            for (let i = 0; i < plan.days; i++) {
                const date = new Date(startDate);
                date.setDate(startDate.getDate() + i);
                const dateStr = date.toISOString().split('T')[0];
                const status = plan.status[dateStr] || 'incomplete';
                
                // 日期格式
                const dateText = `${date.getFullYear()}/${date.getMonth()+1}/${date.getDate()}`;
                pdf.text(dateText, 20, y);
                
                // 使用符号表示状态
                switch(status) {
                    case 'complete':
                        pdf.text("✔ Completed", 100, y);
                        break;
                    case 'incomplete':
                        pdf.text("✘ Incomplete", 100, y);
                        break;
                    case 'noclass':
                        pdf.text("— No Class", 100, y);
                        break;
                    case 'leave':
                        pdf.text("↗ Leave", 100, y);
                        break;
                }
                
                y += 7;
                
                // 分页
                if (y > 280) {
                    pdf.addPage();
                    y = 20;
                    // 在新页添加标题
                    pdf.setFontSize(12);
                    pdf.text("Date", 20, y);
                    pdf.text("Status", 100, y);
                    y = 27;
                }
            }
            
            pdf.save(`${student.name}_Study_Plan.pdf`);
        }
        
        // 开始学习
        function startLearning() {
            const studentId = document.getElementById('studentSelect').value;
            const libId = document.getElementById('wordLibSelect').value;
            const unitName = document.getElementById('unitSelect').value;
            const wordStatus = document.getElementById('wordStatus').value;
            const wordCount = parseInt(document.getElementById('wordCount').value) || 0;
            
            if (!studentId || !libId || !unitName) {
                alert('请选择学员、词库和单元');
                return;
            }
            
            const student = systemData.students.find(s => s.id === studentId);
            const wordLib = systemData.wordLibs.find(l => l.id === libId);
            
            // 查找选中的单元
            const unit = wordLib?.units?.find(u => u.name === unitName);
            let words = unit?.words || [];
            
            if (!student || !wordLib || words.length === 0) {
                alert('数据错误，请重试');
                return;
            }
            
            // 根据词汇情况筛选单词
            if (wordStatus === 'learned') {
                words = words.filter(word => word.learned > 0);
            } else if (wordStatus === 'unlearned') {
                words = words.filter(word => word.learned === 0);
            }
            
            // 如果设置了词汇数量，则截取指定数量的单词
            if (wordCount > 0 && wordCount < words.length) {
                words = shuffleArray(words).slice(0, wordCount);
            }
            
            // 显示学习区域
            document.getElementById('progressSection').style.display = 'block';
            document.getElementById('wordStudySection').style.display = 'block';
            
            // 更新进度
            document.getElementById('totalWords').textContent = words.length;
            document.getElementById('learnedWords').textContent = 0;
            document.getElementById('progressPercent').textContent = 0;
            document.getElementById('progressBar').style.width = '0%';
            
            // 渲染单词卡片
            renderWordCards(words);
            
            // 设置当前学习会话
            systemData.currentSession = {
                type: 'learning',
                studentId,
                libId,
                unitName,
                words: words.map(word => ({...word})), // 创建副本
                learnedCount: 0,
                startTime: new Date().toISOString()
            };
        }
        
        // 渲染单词卡片
        function renderWordCards(words) {
            const container = document.getElementById('wordGrid');
            container.innerHTML = '';
            
            words.forEach(word => {
                const card = document.createElement('div');
                card.className = 'word-card';
                card.innerHTML = `
                    <h4 onclick="speakWord('${word.english}')">${word.english}</h4>
                    <div class="word-info" style="display:none;">
                        <div>${word.phonetic}</div>
                        <div>${word.chinese}</div>
                    </div>
                    <div class="word-actions">
                        <div class="action-btn" style="background:var(--info);" onclick="toggleWordInfo(this)"><i class="fas fa-eye"></i></div>
                        <div class="action-btn" style="background:var(--success);" onclick="markWord(this, '${word.id}', true)"><i class="fas fa-check"></i></div>
                        <div class="action-btn" style="background:var(--danger);" onclick="markWord(this, '${word.id}', false)"><i class="fas fa-times"></i></div>
                    </div>
                `;
                container.appendChild(card);
            });
        }
        
        // 显示/隐藏单词信息
        function toggleWordInfo(btn) {
            const card = btn.closest('.word-card');
            const info = card.querySelector('.word-info');
            info.style.display = info.style.display === 'none' ? 'flex' : 'none';
        }
        
        // 标记单词
        function markWord(btn, wordId, known) {
            const card = btn.closest('.word-card');
            
            // 更新UI
            if (known) {
                card.style.borderColor = '#4cc9f0';
                card.style.backgroundColor = '#f0f9ff';
            } else {
                card.style.borderColor = '#e63946';
                card.style.backgroundColor = '#fff0f0';
                
                // 添加到生词本
                if (systemData.currentSession) {
                    const vocabBook = systemData.vocabularyBooks[systemData.currentSession.studentId] || [];
                    
                    // 检查是否已在生词本中
                    if (!vocabBook.some(w => w.id === wordId)) {
                        const word = systemData.currentSession.words.find(w => w.id === wordId);
                        if (word) {
                            vocabBook.push({
                                ...word,
                                correctCount: 0
                            });
                            systemData.vocabularyBooks[systemData.currentSession.studentId] = vocabBook;
                            saveSystemData();
                        }
                    }
                }
            }
            
            // 更新学习进度
            if (systemData.currentSession) {
                // 更新会话中的单词状态
                const sessionWord = systemData.currentSession.words.find(w => w.id === wordId);
                if (sessionWord) {
                    sessionWord.known = known;
                    sessionWord.learned = (sessionWord.learned || 0) + 1;
                }
                
                // 更新原始词库中的单词状态
                const wordLib = systemData.wordLibs.find(lib => lib.id === systemData.currentSession.libId);
                if (wordLib) {
                    const unit = wordLib.units.find(u => u.name === systemData.currentSession.unitName);
                    if (unit) {
                        const originalWord = unit.words.find(w => w.id === wordId);
                        if (originalWord) {
                            originalWord.known = known;
                            originalWord.learned = (originalWord.learned || 0) + 1;
                        }
                    }
                }
                
                // 更新进度计数
                const learnedWords = systemData.currentSession.words.filter(w => w.learned > 0).length;
                systemData.currentSession.learnedCount = learnedWords;
                
                // 更新UI
                const totalWords = parseInt(document.getElementById('totalWords').textContent);
                const percent = Math.round((learnedWords / totalWords) * 100);
                
                document.getElementById('learnedWords').textContent = learnedWords;
                document.getElementById('progressPercent').textContent = percent;
                document.getElementById('progressBar').style.width = `${percent}%`;
            }
            
            // 禁用按钮
            const actionBtns = card.querySelectorAll('.action-btn');
            actionBtns.forEach(btn => {
                btn.style.opacity = '0.5';
                btn.style.pointerEvents = 'none';
            });
        }
        
        // 完成学习
        function finishLearning() {
            if (!systemData.currentSession || systemData.currentSession.type !== 'learning') {
                alert('没有正在进行的学习会话');
                return;
            }
            
            // 创建学习记录
            const student = systemData.students.find(s => s.id === systemData.currentSession.studentId);
            const wordLib = systemData.wordLibs.find(l => l.id === systemData.currentSession.libId);
            
            if (!student || !wordLib) {
                alert('数据错误，无法创建记录');
                return;
            }
            
            const knownCount = systemData.currentSession.words.filter(word => word.known).length;
            const unknownCount = systemData.currentSession.words.filter(word => !word.known).length;
            
            const record = {
                id: 'rec' + Date.now(),
                type: 'learning',
                studentId: systemData.currentSession.studentId,
                libId: systemData.currentSession.libId,
                unitName: systemData.currentSession.unitName,
                date: new Date().toISOString(),
                words: systemData.currentSession.words.map(word => ({
                    id: word.id,
                    english: word.english,
                    phonetic: word.phonetic,
                    chinese: word.chinese,
                    known: word.known,
                    learned: word.learned
                })),
                totalWords: systemData.currentSession.words.length,
                learnedWords: systemData.currentSession.learnedCount,
                knownCount: knownCount,
                unknownCount: unknownCount
            };
            
            systemData.learningRecords.push(record);
            saveSystemData();
            
            // 显示学习报告
            showLearningReport(record);
        }
        
        // 显示学习报告
        function showLearningReport(record) {
            const student = systemData.students.find(s => s.id === record.studentId);
            const wordLib = systemData.wordLibs.find(l => l.id === record.libId);
            
            if (!student || !wordLib) {
                alert('数据错误，无法显示报告');
                return;
            }
            
            let reportHTML = `
                <div class="report-card">
                    <div class="report-header">
                        <h2>单词学习报告</h2>
                        <p>${student.name} | ${new Date(record.date).toLocaleString()}</p>
                        <p>词库: ${wordLib.name} - ${record.unitName}</p>
                    </div>
                    
                    <div class="report-stats">
                        <div class="stat-card">
                            <h3>${record.totalWords}</h3>
                            <p>总词汇量</p>
                        </div>
                        <div class="stat-card">
                            <h3>${record.learnedWords}</h3>
                            <p>已学习词汇</p>
                        </div>
                        <div class="stat-card">
                            <h3>${record.knownCount}</h3>
                            <p>认识词汇</p>
                        </div>
                        <div class="stat-card">
                            <h3>${record.unknownCount}</h3>
                            <p>不认识词汇</p>
                        </div>
                    </div>
                    
                    <h3>词汇列表</h3>
                    <div class="word-list">
            `;
            
            record.words.forEach(word => {
                reportHTML += `
                    <div class="word-item">
                        <div onclick="speakWord('${word.english}')">
                            <strong>${word.english}</strong>
                            <div>${word.phonetic} | ${word.chinese}</div>
                        </div>
                        <div>
                            <span style="color:${word.known ? 'green' : 'red'}">${word.known ? '认识' : '不认识'}</span>
                            <div>学习次数: ${word.learned}</div>
                        </div>
                    </div>
                `;
            });
            
            reportHTML += `
                    </div>
                </div>
            `;
            
            document.getElementById('reportContent').innerHTML = reportHTML;
            
            // 设置返回按钮
            document.getElementById('reportBackBtn').onclick = function() {
                showPage('wordStudyPage');
            };
            
            showPage('reportPage');
        }
        
        // 显示复习模态框
        function showReviewModal(reviewType) {
            document.getElementById('reviewModal').style.display = 'flex';
            document.getElementById('startReviewBtn').dataset.type = reviewType;
            
            // 填充词库选择
            const reviewLibSelect = document.getElementById('reviewLib');
            reviewLibSelect.innerHTML = '<option value="">选择词库</option>';
            
            systemData.wordLibs.forEach(lib => {
                const option = document.createElement('option');
                option.value = lib.id;
                option.textContent = lib.name;
                reviewLibSelect.appendChild(option);
            });
            
            // 为词库选择添加change事件
            document.getElementById('reviewLib').addEventListener('change', function() {
                const libId = this.value;
                const unitSelect = document.getElementById('reviewUnit');
                unitSelect.innerHTML = '<option value="">选择单元</option>';
                
                if (libId) {
                    const lib = systemData.wordLibs.find(l => l.id === libId);
                    if (lib && lib.units) {
                        lib.units.forEach(unit => {
                            const option = document.createElement('option');
                            option.value = unit.name;
                            option.textContent = unit.name;
                            unitSelect.appendChild(option);
                        });
                    }
                    
                    // 显示复习筛选区域
                    document.getElementById('reviewFilterSection').style.display = 'block';
                }
            });
            
            // 监听词汇来源变化
            document.querySelectorAll('input[name="reviewSource"]').forEach(radio => {
                radio.addEventListener('change', function() {
                    document.getElementById('libSelection').style.display = 
                        this.value === 'wordLib' ? 'block' : 'none';
                    
                    // 如果选择了词库来源，显示筛选区域
                    document.getElementById('reviewFilterSection').style.display = 
                        this.value === 'wordLib' ? 'block' : 'none';
                });
            });
            
            // 监听单元选择变化
            document.getElementById('reviewUnit').addEventListener('change', function() {
                const studentId = document.getElementById('reviewStudent').value;
                const libId = document.getElementById('reviewLib').value;
                const unitName = this.value;
                
                if (!studentId || !libId || !unitName) return;
                
                // 更新词汇统计信息
                updateReviewWordStats(studentId, libId, unitName);
            });
        }
        
        // 更新复习词汇统计信息
        function updateReviewWordStats(studentId, libId, unitName) {
            const wordLib = systemData.wordLibs.find(lib => lib.id === libId);
            if (!wordLib) return;
            
            const unit = wordLib.units.find(u => u.name === unitName);
            if (!unit || !unit.words) return;
            
            // 计算各种状态的词汇数量
            let totalWords = unit.words.length;
            let learnedWords = 0;
            let unlearnedWords = 0;
            
            unit.words.forEach(word => {
                if (word.learned > 0) {
                    learnedWords++;
                } else {
                    unlearnedWords++;
                }
            });
            
            // 更新统计信息显示
            document.getElementById('reviewWordCountInfo').textContent = 
                `总词汇: ${totalWords} | 已学: ${learnedWords} | 未学: ${unlearnedWords}`;
        }
        
        // 关闭模态框
        function closeModal() {
            document.getElementById('importModal').style.display = 'none';
            document.getElementById('batchAddModal').style.display = 'none';
            document.getElementById('reviewModal').style.display = 'none';
            document.getElementById('createPlanModal').style.display = 'none';
        }
        
        // 开始复习
        function startReview() {
            closeModal();
            
            const studentId = document.getElementById('reviewStudent').value;
            const source = document.querySelector('input[name="reviewSource"]:checked').value;
            const reviewType = document.getElementById('startReviewBtn').dataset.type;
            const wordStatus = document.getElementById('reviewWordStatus').value;
            const wordCount = parseInt(document.getElementById('reviewWordCount').value) || 0;
            
            if (!studentId) {
                alert('请选择学员');
                return;
            }
            
            let words = [];
            
            if (source === 'vocabularyBook') {
                // 从生字本获取词汇
                words = [...(systemData.vocabularyBooks[studentId] || [])];
            } else {
                // 使用词库中的单词
                const libId = document.getElementById('reviewLib').value;
                const unitName = document.getElementById('reviewUnit').value;
                
                if (!libId || !unitName) {
                    alert('请选择词库和单元');
                    return;
                }
                
                const wordLib = systemData.wordLibs.find(l => l.id === libId);
                if (wordLib && wordLib.units) {
                    const unit = wordLib.units.find(u => u.name === unitName);
                    if (unit && unit.words) {
                        words = [...unit.words];
                    }
                }
            }
            
            // 检查词汇是否有效
            if (!words || words.length === 0) {
                alert('没有可复习的单词');
                return;
            }
            
            // 根据词汇情况筛选单词
            if (wordStatus === 'learned') {
                words = words.filter(word => word.learned > 0);
            } else if (wordStatus === 'unlearned') {
                words = words.filter(word => word.learned === 0);
            }
            
            // 如果设置了词汇数量，则截取指定数量的单词
            if (wordCount > 0 && wordCount < words.length) {
                words = shuffleArray(words).slice(0, wordCount);
            }
            
            // 设置当前复习会话
            systemData.currentSession = {
                type: 'review',
                reviewType,
                studentId,
                words: shuffleArray(words),
                currentIndex: 0,
                correctCount: 0,
                wrongCount: 0,
                startTime: new Date().toISOString()
            };
            
            // 显示答题区域
            document.getElementById('quizSection').style.display = 'block';
            
            // 开始第一个问题
            startNextQuestion();
        }
        
        // 开始下一个问题
        function startNextQuestion() {
            const session = systemData.currentSession;
            if (!session || session.currentIndex >= session.words.length) {
                finishQuiz();
                return;
            }
            
            const currentWord = session.words[session.currentIndex];
            
            // 更新进度
            document.getElementById('quizCount').textContent = session.currentIndex + 1;
            document.getElementById('totalQuiz').textContent = session.words.length;
            document.getElementById('correctCount').textContent = session.correctCount;
            document.getElementById('wrongCount').textContent = session.wrongCount;
            
            // 根据复习类型生成问题
            switch(session.reviewType) {
                case 'wordToMeaning':
                    renderWordToMeaningQuiz(currentWord, session.words);
                    break;
                case 'meaningToWord':
                    renderMeaningToWordQuiz(currentWord, session.words);
                    break;
                case 'soundToWord':
                    renderSoundToWordQuiz(currentWord, session.words);
                    break;
            }
        }
        
        // 渲染"看词选义"问题
        function renderWordToMeaningQuiz(word, currentWords) {
            const quizArea = document.getElementById('quizArea');
            
            // 生成错误选项（从当前单元中）
            const options = generateWrongOptions(word, 1, currentWords, 3);
            // 将正确答案插入到随机位置
            const correctPosition = Math.floor(Math.random() * (options.length + 1));
            options.splice(correctPosition, 0, word.chinese);
            
            let optionsHTML = '';
            options.forEach((option, index) => {
                optionsHTML += `
                    <div class="quiz-option" onclick="checkAnswer(${index}, '${option.replace(/'/g, "\\'")}', '${word.chinese.replace(/'/g, "\\'")}')">
                        ${option}
                    </div>
                `;
            });
            
            quizArea.innerHTML = `
                <div class="quiz-word" onclick="speakWord('${word.english.replace(/'/g, "\\'")}')">${word.english}</div>
                <div class="quiz-options">
                    ${optionsHTML}
                </div>
            `;
        }
        
        // 渲染"看义选词"问题
        function renderMeaningToWordQuiz(word, currentWords) {
            const quizArea = document.getElementById('quizArea');
            
            // 生成错误选项（从当前单元中）
            const options = generateWrongOptions(word, 0, currentWords, 3);
            // 将正确答案插入到随机位置
            const correctPosition = Math.floor(Math.random() * (options.length + 1));
            options.splice(correctPosition, 0, word.english);
            
            let optionsHTML = '';
            options.forEach((option, index) => {
                optionsHTML += `
                    <div class="quiz-option" onclick="checkAnswer(${index}, '${option.replace(/'/g, "\\'")}', '${word.english.replace(/'/g, "\\'")}')">
                        ${option}
                    </div>
                `;
            });
            
            quizArea.innerHTML = `
                <div class="quiz-word">${word.chinese}</div>
                <div class="quiz-options">
                    ${optionsHTML}
                </div>
            `;
        }
        
        // 渲染"听音选词"问题
        function renderSoundToWordQuiz(word, currentWords) {
            const quizArea = document.getElementById('quizArea');
            
            // 生成错误选项（从当前单元中）
            const options = generateWrongOptions(word, 0, currentWords, 3);
            // 将正确答案插入到随机位置
            const correctPosition = Math.floor(Math.random() * (options.length + 1));
            options.splice(correctPosition, 0, word.english);
            
            let optionsHTML = '';
            options.forEach((option, index) => {
                optionsHTML += `
                    <div class="quiz-option" onclick="checkAnswer(${index}, '${option.replace(/'/g, "\\'")}', '${word.english.replace(/'/g, "\\'")}')">
                        ${option}
                    </div>
                `;
            });
            
            quizArea.innerHTML = `
                <div class="quiz-word" onclick="speakWord('${word.english.replace(/'/g, "\\'")}')">
                    <i class="fas fa-volume-up" style="font-size: 3rem; color: var(--primary);"></i>
                    <div style="margin-top: 10px; font-size: 1.2rem;">点击图标听发音</div>
                </div>
                <div class="quiz-options">
                    ${optionsHTML}
                </div>
            `;
        }
        
        // 生成错误选项
        function generateWrongOptions(correctWord, type, currentWords, count = 3) {
            const wrongOptions = [];
            
            // 过滤掉正确答案
            const otherWords = currentWords.filter(word => word.id !== correctWord.id);
            
            // 如果当前单元单词不足，从整个词库补充
            let candidateWords = [...otherWords];
            if (candidateWords.length < count) {
                // 从所有词库的所有单元中获取单词（排除正确答案）
                const allWords = systemData.wordLibs.flatMap(lib => 
                    (lib.units || []).flatMap(unit => unit.words || [])
                );
                // 排除正确答案和已存在的单词
                const additionalWords = allWords.filter(word => 
                    word.id !== correctWord.id && !otherWords.some(w => w.id === word.id)
                );
                candidateWords = [...candidateWords, ...additionalWords];
            }
            
            // 打乱候选单词顺序
            shuffleArray(candidateWords);
            
            // 获取指定数量的错误选项
            for (let i = 0; i < Math.min(count, candidateWords.length); i++) {
                const randomWord = candidateWords[i];
                wrongOptions.push(type === 0 ? randomWord.english : randomWord.chinese);
            }
            
            return wrongOptions;
        }
        
        // 检查答案
        function checkAnswer(optionIndex, selectedValue, correctAnswer) {
            const options = document.querySelectorAll('.quiz-option');
            const selectedOption = options[optionIndex];
            
            // 清除之前的状态
            options.forEach(option => {
                option.classList.remove('correct', 'incorrect');
            });
            
            if (selectedValue === correctAnswer) {
                // 回答正确
                selectedOption.classList.add('correct');
                systemData.currentSession.correctCount++;
            } else {
                // 回答错误
                selectedOption.classList.add('incorrect');
                systemData.currentSession.wrongCount++;
                
                // 高亮显示正确答案
                options.forEach(option => {
                    if (option.textContent.trim() === correctAnswer) {
                        option.classList.add('correct');
                    }
                });
            }
            
            // 禁用所有选项
            options.forEach(option => {
                option.style.pointerEvents = 'none';
            });
            
            // 延迟后进入下一题
            setTimeout(() => {
                systemData.currentSession.currentIndex++;
                startNextQuestion();
            }, 1500);
        }
        
        // 完成复习
        function finishQuiz() {
            if (!systemData.currentSession || systemData.currentSession.type !== 'review') {
                alert('没有正在进行的复习会话');
                return;
            }
            
            const session = systemData.currentSession;
            
            // 创建复习记录
            const student = systemData.students.find(s => s.id === session.studentId);
            
            if (!student) {
                alert('数据错误，无法创建记录');
                return;
            }
            
            const record = {
                id: 'rec' + Date.now(),
                type: 'review',
                reviewType: session.reviewType,
                studentId: session.studentId,
                date: new Date().toISOString(),
                words: session.words.map(word => ({
                    id: word.id,
                    english: word.english,
                    phonetic: word.phonetic,
                    chinese: word.chinese
                })),
                totalWords: session.words.length,
                correctCount: session.correctCount,
                wrongCount: session.wrongCount
            };
            
            systemData.learningRecords.push(record);
            saveSystemData();
            
            // 显示复习报告
            showReviewReport(record);
        }
        
        // 显示复习报告
        function showReviewReport(record) {
            const student = systemData.students.find(s => s.id === record.studentId);
            
            if (!student) {
                alert('数据错误，无法显示报告');
                return;
            }
            
            let reviewTypeText = '';
            switch(record.reviewType) {
                case 'wordToMeaning': reviewTypeText = '看词选义'; break;
                case 'meaningToWord': reviewTypeText = '看义选词'; break;
                case 'soundToWord': reviewTypeText = '听音选词'; break;
            }
            
            let reportHTML = `
                <div class="report-card">
                    <div class="report-header">
                        <h2>复习报告</h2>
                        <p>${student.name} | ${new Date(record.date).toLocaleString()} | ${reviewTypeText}</p>
                    </div>
                    
                    <div class="report-stats">
                        <div class="stat-card">
                            <h3>${record.totalWords}</h3>
                            <p>总词汇量</p>
                        </div>
                        <div class="stat-card">
                            <h3>${record.correctCount}</h3>
                            <p>答对数量</p>
                        </div>
                        <div class="stat-card">
                            <h3>${record.wrongCount}</h3>
                            <p>答错数量</p>
                        </div>
                        <div class="stat-card">
                            <h3>${Math.round((record.correctCount / record.totalWords) * 100)}%</h3>
                            <p>正确率</p>
                        </div>
                    </div>
                    
                    <h3>词汇列表</h3>
                    <div class="word-list">
            `;
            
            record.words.forEach(word => {
                reportHTML += `
                    <div class="word-item">
                        <div onclick="speakWord('${word.english}')">
                            <strong>${word.english}</strong>
                            <div>${word.phonetic} | ${word.chinese}</div>
                        </div>
                    </div>
                `;
            });
            
            reportHTML += `
                    </div>
                </div>
            `;
            
            document.getElementById('reportContent').innerHTML = reportHTML;
            
            // 设置返回按钮
            document.getElementById('reportBackBtn').onclick = function() {
                showPage('reviewPage');
            };
            
            showPage('reportPage');
        }
        
        // 渲染生字本
        function renderVocabularyBooks() {
            const container = document.getElementById('vocabBooks');
            container.innerHTML = '';
            
            systemData.students.forEach(student => {
                const vocabBook = systemData.vocabularyBooks[student.id] || [];
                
                const bookCard = document.createElement('div');
                bookCard.className = 'record-card';
                bookCard.innerHTML = `
                    <div class="record-header">
                        <div class="record-title">${student.name} 的生字本</div>
                        <div class="record-meta">
                            <span>生词数量: ${vocabBook.length}</span>
                        </div>
                    </div>
                    
                    <button class="btn" onclick="viewVocabularyBook('${student.id}')"><i class="fas fa-eye"></i> 查看生字本</button>
                `;
                
                container.appendChild(bookCard);
            });
        }
        
        // 查看生字本
        function viewVocabularyBook(studentId) {
            const student = systemData.students.find(s => s.id === studentId);
            const vocabBook = systemData.vocabularyBooks[studentId] || [];
            
            if (!student) return;
            
            let reportHTML = `
                <div class="report-card">
                    <div class="report-header">
                        <h2>${student.name} 的生字本</h2>
                        <p>${vocabBook.length}个生词</p>
                    </div>
                    
                    <div class="word-list">
            `;
            
            vocabBook.forEach(word => {
                reportHTML += `
                    <div class="word-item">
                        <div onclick="speakWord('${word.english}')">
                            <strong>${word.english}</strong>
                            <div>${word.phonetic} | ${word.chinese}</div>
                        </div>
                        <div>
                            <span>已掌握次数: ${word.correctCount || 0}/3</span>
                        </div>
                    </div>
                `;
            });
            
            reportHTML += `
                    </div>
                </div>
            `;
            
            document.getElementById('reportContent').innerHTML = reportHTML;
            
            // 设置返回按钮
            document.getElementById('reportBackBtn').onclick = function() {
                showPage('vocabularyBookPage');
            };
            
            showPage('reportPage');
        }
        
        // 渲染学习记录
        function renderRecords() {
            const container = document.getElementById('recordList');
            container.innerHTML = '';
            
            const studentId = document.getElementById('recordStudent').value;
            const recordType = document.getElementById('recordType').value;
            const startDate = document.getElementById('startDate').value;
            const endDate = document.getElementById('endDate').value;
            
            const filteredRecords = systemData.learningRecords.filter(record => {
                // 学员筛选
                if (studentId && record.studentId !== studentId) return false;
                
                // 类型筛选
                if (recordType && record.type !== recordType) return false;
                
                // 日期筛选
                const recordDate = new Date(record.date).toISOString().split('T')[0];
                if (startDate && recordDate < startDate) return false;
                if (endDate && recordDate > endDate) return false;
                
                return true;
            });
            
            if (filteredRecords.length === 0) {
                container.innerHTML = '<div style="text-align:center; padding:20px; color:#666;">没有找到匹配的学习记录</div>';
                return;
            }
            
            filteredRecords.forEach(record => {
                const student = systemData.students.find(s => s.id === record.studentId);
                const wordLib = systemData.wordLibs.find(l => l.id === record.libId);
                
                if (!student) return;
                
                const recordCard = document.createElement('div');
                recordCard.className = 'record-card';
                
                let recordTypeText = '';
                let libInfo = '';
                
                if (record.type === 'learning') {
                    recordTypeText = '单词学习';
                    if (wordLib) {
                        libInfo = `词库: ${wordLib.name} - ${record.unitName || '未指定单元'}`;
                    }
                } else {
                    let type = '';
                    switch(record.reviewType) {
                        case 'wordToMeaning': type = '看词选义'; break;
                        case 'meaningToWord': type = '看义选词'; break;
                        case 'soundToWord': type = '听音选词'; break;
                    }
                    recordTypeText = `抗遗忘复习 - ${type}`;
                    if (wordLib) {
                        libInfo = `词库: ${wordLib.name}`;
                    }
                }
                
                recordCard.innerHTML = `
                    <div class="record-header">
                        <div class="record-title">${student.name} - ${recordTypeText}</div>
                        <div class="record-meta">
                            <span>${new Date(record.date).toLocaleString()}</span>
                            <span>${libInfo}</span>
                            <span>词汇数量: ${record.totalWords}</span>
                        </div>
                    </div>
                    <div class="record-actions">
                        <button class="btn" onclick="viewRecord('${record.id}')"><i class="fas fa-file-alt"></i> 查看详情</button>
                        <button class="btn" onclick="exportRecordToPDF('${record.id}')"><i class="fas fa-file-pdf"></i> 导出PDF</button>
                        <button class="btn btn-danger" onclick="deleteRecord('${record.id}')"><i class="fas fa-trash"></i> 删除</button>
                    </div>
                `;
                
                container.appendChild(recordCard);
            });
        }
        
        // 筛选记录
        function filterRecords() {
            renderRecords();
        }
        
        // 查看记录详情
        function viewRecord(recordId) {
            const record = systemData.learningRecords.find(r => r.id === recordId);
            if (!record) return;
            
            if (record.type === 'learning') {
                showLearningReport(record);
            } else {
                showReviewReport(record);
            }
        }
        
        // 导出记录PDF
        function exportRecordToPDF(recordId) {
            const record = systemData.learningRecords.find(r => r.id === recordId);
            if (!record) return;
            
            const student = systemData.students.find(s => s.id === record.studentId);
            if (!student) return;
            
            // 创建临时容器用于生成PDF
            const tempContainer = document.createElement('div');
            tempContainer.style.position = 'absolute';
            tempContainer.style.left = '-9999px';
            tempContainer.style.top = '0';
            tempContainer.style.width = '794px'; // A4宽度
            tempContainer.style.padding = '20px';
            tempContainer.style.backgroundColor = 'white';
            tempContainer.style.fontFamily = "'Segoe UI', Tahoma, Geneva, Verdana, sans-serif";
            
            // 生成报告HTML内容
            let reportHTML = `
                <div style="max-width:750px; margin:0 auto; color:#333;">
                    <div style="text-align:center; margin-bottom:20px;">
                        <h2 style="color:#3f37c9; font-size:24px; margin-bottom:10px;">
                            ${record.type === 'learning' ? '单词学习报告' : '复习报告'}
                        </h2>
                        <p style="color:#666; font-size:16px;">
                            ${student.name} | ${new Date(record.date).toLocaleString()}
                        </p>
            `;
            
            if (record.type === 'learning') {
                reportHTML += `<p style="color:#666; font-size:16px;">
                    词库: ${systemData.wordLibs.find(l => l.id === record.libId)?.name || '未知'} - ${record.unitName || '未指定单元'}
                </p>`;
            } else {
                let reviewType = '';
                switch(record.reviewType) {
                    case 'wordToMeaning': reviewType = '看词选义'; break;
                    case 'meaningToWord': reviewType = '看义选词'; break;
                    case 'soundToWord': reviewType = '听音选词'; break;
                }
                reportHTML += `<p style="color:#666; font-size:16px;">复习类型: ${reviewType}</p>`;
            }
            
            reportHTML += `
                    </div>
                    
                    <div style="display:grid; grid-template-columns:repeat(4, 1fr); gap:15px; margin-bottom:30px;">
                        <div style="background:#f8f9fa; border-radius:10px; padding:15px; text-align:center;">
                            <h3 style="font-size:24px; color:#3f37c9; margin-bottom:5px;">${record.totalWords}</h3>
                            <p style="color:#666;">总词汇量</p>
                        </div>
            `;
            
            if (record.type === 'learning') {
                reportHTML += `
                        <div style="background:#f8f9fa; border-radius:10px; padding:15px; text-align:center;">
                            <h3 style="font-size:24px; color:#3f37c9; margin-bottom:5px;">${record.learnedWords}</h3>
                            <p style="color:#666;">已学习词汇</p>
                        </div>
                        <div style="background:#f8f9fa; border-radius:10px; padding:15px; text-align:center;">
                            <h3 style="font-size:24px; color:#3f37c9; margin-bottom:5px;">${record.knownCount}</h3>
                            <p style="color:#666;">认识词汇</p>
                        </div>
                        <div style="background:#f8f9fa; border-radius:10px; padding:15px; text-align:center;">
                            <h3 style="font-size:24px; color:#3f37c9; margin-bottom:5px;">${record.unknownCount}</h3>
                            <p style="color:#666;">不认识词汇</p>
                        </div>
                `;
            } else {
                reportHTML += `
                        <div style="background:#f8f9fa; border-radius:10px; padding:15px; text-align:center;">
                            <h3 style="font-size:24px; color:#3f37c9; margin-bottom:5px;">${record.correctCount}</h3>
                            <p style="color:#666;">答对数量</p>
                        </div>
                        <div style="background:#f8f9fa; border-radius:10px; padding:15px; text-align:center;">
                            <h3 style="font-size:24px; color:#3f37c9; margin-bottom:5px;">${record.wrongCount}</h3>
                            <p style="color:#666;">答错数量</p>
                        </div>
                        <div style="background:#f8f9fa; border-radius:10px; padding:15px; text-align:center;">
                            <h3 style="font-size:24px; color:#3f37c9; margin-bottom:5px;">
                                ${Math.round((record.correctCount / record.totalWords) * 100)}%
                            </h3>
                            <p style="color:#666;">正确率</p>
                        </div>
                `;
            }
            
            reportHTML += `
                    </div>
                    
                    <h3 style="color:#3f37c9; border-bottom:2px solid #4895ef; padding-bottom:10px; margin-bottom:15px;">
                        词汇列表
                    </h3>
                    <div style="margin-top:20px;">
            `;
            
            record.words.forEach(word => {
                reportHTML += `
                    <div style="display:flex; justify-content:space-between; align-items:center; 
                                padding:10px; border-bottom:1px solid #eee;">
                        <div>
                            <strong style="font-size:18px;">${word.english}</strong>
                            <div style="color:#666; margin-top:5px;">
                                ${word.phonetic} | ${word.chinese}
                            </div>
                        </div>
                `;
                
                if (record.type === 'learning') {
                    reportHTML += `
                        <div style="text-align:right;">
                            <span style="color:${word.known ? 'green' : 'red'}">
                                ${word.known ? '认识' : '不认识'}
                            </span>
                            <div style="color:#666; margin-top:5px;">
                                学习次数: ${word.learned}
                            </div>
                        </div>
                    `;
                }
                
                reportHTML += `</div>`;
            });
            
            reportHTML += `
                    </div>
                </div>
            `;
            
            tempContainer.innerHTML = reportHTML;
            document.body.appendChild(tempContainer);
            
            // 使用html2canvas生成图片
            html2canvas(tempContainer, {
                scale: 2,
                useCORS: true,
                logging: false,
                backgroundColor: "#FFFFFF"
            }).then(canvas => {
                const imgData = canvas.toDataURL('image/png');
                const pdf = new jspdf.jsPDF('p', 'mm', 'a4');
                const imgWidth = 210;
                const pageHeight = 297;
                const imgHeight = canvas.height * imgWidth / canvas.width;
                
                // 处理多页内容
                let heightLeft = imgHeight;
                let position = 0;
                
                pdf.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);
                heightLeft -= pageHeight;
                
                while (heightLeft >= 0) {
                    position = heightLeft - imgHeight;
                    pdf.addPage();
                    pdf.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);
                    heightLeft -= pageHeight;
                }
                
                pdf.save(`${student.name}_学习记录.pdf`);
                document.body.removeChild(tempContainer);
            }).catch(error => {
                console.error('导出失败:', error);
                alert('导出失败，请重试');
                document.body.removeChild(tempContainer);
            });
        }
        
        // 删除记录
        function deleteRecord(recordId) {
            if (!confirm('确定要删除这条记录吗？此操作不可恢复。')) return;
            
            systemData.learningRecords = systemData.learningRecords.filter(r => r.id !== recordId);
            saveSystemData();
            renderRecords();
        }
        
        // 导出PDF报告
        function exportToPDF() {
            const reportContent = document.getElementById('reportContent');
            
            html2canvas(reportContent).then(canvas => {
                const imgData = canvas.toDataURL('image/png');
                const pdf = new jspdf.jsPDF('p', 'mm', 'a4');
                const imgWidth = 210;
                const pageHeight = 297;
                const imgHeight = canvas.height * imgWidth / canvas.width;
                let heightLeft = imgHeight;
                let position = 0;
                
                pdf.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);
                heightLeft -= pageHeight;
                
                while (heightLeft >= 0) {
                    position = heightLeft - imgHeight;
                    pdf.addPage();
                    pdf.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);
                    heightLeft -= pageHeight;
                }
                
                pdf.save('学习报告_' + new Date().toLocaleDateString() + '.pdf');
            });
        }
        
        // 单词发音功能（使用Web Speech API）
        function speakWord(word) {
            if ('speechSynthesis' in window) {
                // 停止任何正在进行的发音
                speechSynthesis.cancel();
                
                // 创建新的语音合成对象
                const utterance = new SpeechSynthesisUtterance(word);
                utterance.lang = 'en-US';
                utterance.rate = 0.8; // 稍微慢一点的速度
                
                // 尝试找到合适的语音
                const voices = speechSynthesis.getVoices();
                const englishVoice = voices.find(voice => 
                    voice.lang.includes('en') && voice.name.includes('Google')
                );
                
                if (englishVoice) {
                    utterance.voice = englishVoice;
                }
                
                // 播放发音
                speechSynthesis.speak(utterance);
            } else {
                alert('您的浏览器不支持语音合成功能');
            }
        }
        
        // 打乱数组顺序
        function shuffleArray(array) {
            const result = [...array];
            for (let i = result.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [result[i], result[j]] = [result[j], result[i]];
            }
            return result;
        }
        
        // 初始化页面
        document.addEventListener('DOMContentLoaded', function() {
            // 设置默认显示登录页
            document.getElementById('loginPage').style.display = 'flex';
        });
    </script>
</body>
</html>